{% extends 'base.html.twig' %}
{% set active = 'homepage' %}

{% block title %}Detalle provincial{% endblock %}

{% block content %}
<!--div class="page-header">
  <h2>Plataforma de monitoreo de la mortalidad materna</h2>
</div-->

<p>La distribución de las muertes maternas varía mucho de provincia en provincia. El seguimiento local de los <a href="{{ path("odm") }}">Objetivos del Milenio</a>, incorporó la meta de disminuir en un 10% esta brecha existente. Las brechas económicas existentes en el país se reflejan en valores dispares de la tasa de muerte materna: desagregar la información a nivel departamental permite tomar decisiones acertadas en base a realidades locales.</p>


<ul class="nav nav-tabs" id="main-tabs">
  <li class="pull-right"><a href="{{ path("contexto") }}">Contexto</a></li>
  <li class="pull-right"><a href="{{ path("odm") }}">ODM</a></li>
  <li class="active pull-right"><a href="{{ path("provincial") }}">Provincia</a></li>
  <li class="pull-right"><a href="{{ path("homepage") }}">País</a></li>
</ul>

<section id="main-content">
  <div class="row-fluid">
 	<!-- div class="alert">
      <button type="button" class="close" data-dismiss="alert">×</button>
      <strong>Tip!</strong> Los gráficos de la derecha contextualizan esta vista detalle a nivel departamentos con información adicional de tipo socioeconómico para la provincia.
    </div --> 
    <!--h4>Las mujeres y la muerte materna <span id="nombre-provincia"></span></h4-->

    

    <hr />

    <div class="tabbable tabs-left">
      <ul id="filtros" class="nav nav-tabs">
        <li>
          <a href="#" rel="tooltip" title="Indicador socioeconómico">Indicador socioeconómico</a>
        </li>
        <hr />
        <li class="nav-header">Datos por departamento</li>

        <li>
          <a href="#" rel="tooltip" title="Representa la relación porcentual entre las muertes maternas con residencia en este departamento y la totalidad de muertes maternas de toda la provincia. La leyenda aclara los valores de los matices.">
            <span class="badge-custom" style="background-color: green;"></span> Proporción de muertes maternas
          </a>
        </li>
        <li class="active">
          <a href="#" rel="tooltip" value="residencia"  title="Es el número de muertes maternas con residencia en este departamento.">
            <span class="badge-custom" style="background-color: grey;"></span> Cantidad de muertes por residencia
          </a>
        </li>
        <li>
          <a href="#" rel="tooltip" value="ocurrencia" title="Es el número de muertes maternas que ocurrieron en este departamento.">
            <span class="badge-custom" style="background-color: blue;"></span> Cantidad de muertes por ocurrencia
          </a>
        </li>
        <hr />
        <li class="nav-header" rel="tooltip" title="Elija el año sobre el cual quiere conocer los datos.">Año <span class="label label-info pull-right" id="anio">2010</span></li>
        <li class="navbar-text"><div id="slider" class="slider"></div></li>
		<hr />
		<li class="nav-header" rel="tooltip" title="Seleccione del men&uacute; la provincia a visualizar, puede cambiar de provincia">Elegir provincia</li>
		<li class="navbar-text">
			<select id="provincia11" style="margin-left: 20px; width: 250px;">
				<option value="-1">-- Seleccionar --</option>
				<option value="Buenos Aires">Buenos Aires</option>
				<option value="Capital Federal">Capital Federal</option>
				<option value="Catamarca">Catamarca</option>
				<option value="Chaco">Chaco</option>
				<option value="Chubut">Chubut</option>
				<option value="Cordoba">Cordoba</option>
				<option value="Corrientes">Corrientes</option>
				<option value="Entre Rios">Entre Rios</option>
				<option value="Formosa">Formosa</option>
				<option value="Jujuy">Jujuy</option>
				<option value="La Pampa">La Pampa</option>
				<option value="La Rioja">La Rioja</option>
				<option value="Mendoza">Mendoza</option>
				<option value="Misiones">Misiones</option>
				<option value="Neuquen">Neuquen</option>
				<option value="Rio Negro">Rio Negro</option>
				<option value="Salta">Salta</option>
				<option value="San Juan">San Juan</option>
				<option value="San Luis">San Luis</option>
				<option value="Santa Cruz">Santa Cruz</option>
				<option value="Santa Fe">Santa Fe</option>
				<option value="Santiago del Estero">Santiago del Estero</option>
				<option value="Tierra del Fuego">Tierra del Fuego</option>
				<option value="Tucuman">Tucuman</option>
			</select>
		</li>
		<hr />
		<li class="nav-header" rel="tooltip" title="Seleccione del men&uacute; una provincia para comparar con la provincia que ya est&aacute; visualizando">Comparar con</li>
		<li class="navbar-text">
			<select id="provincia2" style="margin-left: 20px; width: 250px;">
				<option value="-1">-- Seleccionar --</option>
				<option value="Buenos Aires">Buenos Aires</option>
				<option value="Capital Federal">Capital Federal</option>
				<option value="Catamarca">Catamarca</option>
				<option value="Chaco">Chaco</option>
				<option value="Chubut">Chubut</option>
				<option value="Cordoba">Cordoba</option>
				<option value="Corrientes">Corrientes</option>
				<option value="Entre Rios">Entre Rios</option>
				<option value="Formosa">Formosa</option>
				<option value="Jujuy">Jujuy</option>
				<option value="La Pampa">La Pampa</option>
				<option value="La Rioja">La Rioja</option>
				<option value="Mendoza">Mendoza</option>
				<option value="Misiones">Misiones</option>
				<option value="Neuquen">Neuquen</option>
				<option value="Rio Negro">Rio Negro</option>
				<option value="Salta">Salta</option>
				<option value="San Juan">San Juan</option>
				<option value="San Luis">San Luis</option>
				<option value="Santa Cruz">Santa Cruz</option>
				<option value="Santa Fe">Santa Fe</option>
				<option value="Santiago del Estero">Santiago del Estero</option>
				<option value="Tierra del Fuego">Tierra del Fuego</option>
				<option value="Tucuman">Tucuman</option>
			</select>
		</li>
	  </ul>

      <div class="tab-content" style="overflow: hidden;">
        <div class="row-fluid">
          <div class="span5">
            <div id="map-canvas"></div>
          </div>
          <div class="span7">
            <div>
				<p>En el a&ntilde;o <span id="anio-leyenda"></span>, <span id="cantidad-leyenda"></span> mujeres murieron en esta provincia durante el embarazo, parto o posparto por diversas causas . La tasa de muerte materna de la provincia para este año fue de <span id="tasa-leyenda"></span>.</p>
				<div id="visualization-1"></div>
				<select id="type-visualization-1">
					<option value="donde-ocurrio">¿Dónde murieron?</option>
					<option value="covertura-medica">¿Tenían cobertura médica?</option>
					<option value="atencion-medica">¿Tuvieron atención médica?</option>					
					<option value="nivel-instruccion">¿Habían ido a la escuela?</option>
					<option value="edad">¿Qué edad tenían?</option>
					<option value="causa">¿Por qué murieron?</option>
				</select>
            </div>
            <hr />
            <div>
				<div id="visualization-2"></div>
				<select id="type-visualization-2">
					<option value="donde-ocurrio">¿Dónde murieron?</option>
					<option value="covertura-medica">¿Tenían cobertura médica?</option>
					<option value="atencion-medica">¿Tuvieron atención médica?</option>					
					<option value="nivel-instruccion">¿Habían ido a la escuela?</option>
					<option value="edad">¿Qué edad tenían?</option>
					<option value="causa">¿Por qué murieron?</option>
				</select>
            </div>
          </div>
        </div>
		<hr>
		<div id="comparador" class="row-fluid" style="display:none">
			<div class="span5"><div id="map-canvas2"></div></div>
			<div class="span7">						
				<div id="visualization-3"></div>
				<select id="type-visualization-3">
					<option value="donde-ocurrio">¿Dónde murieron?</option>
					<option value="covertura-medica">¿Tenían cobertura médica?</option>
					<option value="atencion-medica">¿Tuvieron atención médica?</option>					
					<option value="nivel-instruccion">¿Habían ido a la escuela?</option>
					<option value="edad">¿Qué edad tenían?</option>
					<option value="causa">¿Por qué murieron?</option>
				</select>
				<div id="visualization-4"></div>
				<select id="type-visualization-4">
					<option value="donde-ocurrio">¿Dónde murieron?</option>
					<option value="covertura-medica">¿Tenían cobertura médica?</option>
					<option value="atencion-medica">¿Tuvieron atención médica?</option>					
					<option value="nivel-instruccion">¿Habían ido a la escuela?</option>
					<option value="edad">¿Qué edad tenían?</option>
					<option value="causa">¿Por qué murieron?</option>
				</select>
			</div>
		</div>
      </div>
    </div>
  </div>
</section>
{% endblock %}

{% block css %}
	<style type="text/css">
		body { padding-top: 60px; }
	  
		#map-canvas { width: auto; height: 500px; }
	  
		#map-canvas2 { width: auto; height: 500px;}

		#legend {
			background: #FFF;
			margin: 10px;
			padding: 5px;
			width: 100px;
		}

		#legend p {
			font-weight: bold;
			margin-top: 3px;
		}

		#legend div { clear: both; }

		.color {
			height: 12px;
			width: 12px;
			margin-right: 3px;
			float: left;
			display: block;
		}

		.high { color: #F00; }

		.medium { color: #0F0; }

		.low { color: #00F; }

		.high, .medium, .low { font-weight: bold; }
      
		.brand { 
			font-weight:600;
			color:#056B74;
			font-family:  verdana, sans-serif;
		}  
    </style>
{% endblock %}

{% block js %}

<script type="text/javascript">
		google.load('visualization', '1', { packages: ['corechart'] });
	
		var LAYER_STYLES = {
			'escala': {'min': 0,'max': 18,'colors': ['#ea9999','#e06666','#cc0000','#990000']}
		}
	
		function getParameterByName(name){
			name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
			var regexS = "[\\?&]" + name + "=([^&#]*)";
			var regex = new RegExp(regexS);
			var results = regex.exec(window.location.search);
			if(results == null)
				return "";
			else
				return decodeURIComponent(results[1].replace(/\+/g, " "));
		}

		var layer = null;
		var layerComp = null;
		var layerDep = null;
		var layerDepComp = null;
		var anio = null;
		var type = null;
		var provincia = null;
		var provinciaComp = null;
		var map = null
		var mapComp = null;
	
		function initialize() {
			type = 'residencia';
			anio = '2010';			
			$( "#anio" ).text( "2010" );
			provincia = getParameterByName("provincia");
			provincia2 = "";
			$("#provincia11").val(provincia);
					
			setProvincia();
						
			$( "#slider" ).slider({
				value:2010, min: 2006, max: 2010, step: 1,
				slide: function( event, ui ) {
					$( "#anio" ).text( ui.value );
					anio = ui.value;
					updateLayerQuery(layer, type, anio, provincia);								
					styleLayerBySector(layer, type);
					drawChartVisualization(anio, provincia, "visualization-1");
					drawChartVisualization(anio, provincia, "visualization-2");
					drawChartVisualization(anio, provincia2, "visualization-3");
					drawChartVisualization(anio, provincia2, "visualization-4");
					setVariablesLeyenda(anio, provincia)
				}
			});	
			
			$("#filtros li a").click(function(e){
				e.preventDefault();
				$(this).tab('show');
				type = this.attributes["value"].nodeValue;	
				updateLayerQuery(layer, type, anio, provincia);			
				updateLegend(type);
				styleLayerBySector(layer, type);				
			});

			$('ul#filtros').tooltip({
				selector: "[rel=tooltip]",
				placement: "right",
			})
		
			$("#provincia11").change(function () {
				provincia = $("#provincia11").val();
				setProvincia();
			});
			
			$("#provincia2").change(function () {
				provincia2 = $("#provincia2").val();
				$("#comparador").show();
				setProvincia2();
			});
			
			$("#type-visualization-1").change(function(){
				drawChartVisualization(anio, provincia, "visualization-1")
			});
			
			$("#type-visualization-2").change(function(){
				drawChartVisualization(anio, provincia, "visualization-2")
			});
			
			$("#type-visualization-3").change(function(){
				drawChartVisualization(anio, provincia, "visualization-3")
			});
			
			$("#type-visualization-4").change(function(){
				drawChartVisualization(anio, provincia, "visualization-4")
			});
		}
	
		function setProvincia(){
			var zoom = 6;
			if (provincia == "")
				zoom = 4;
					
			var geocoder = new google.maps.Geocoder();
			geocoder.geocode({ 'address': "Argentina," + provincia}, function(results,status){
				var latitude = results[0].geometry.location.lat();
				var longitude = results[0].geometry.location.lng();
					
				var map = new google.maps.Map(document.getElementById('map-canvas'), {
					center: new google.maps.LatLng(latitude, longitude),
					zoom: zoom,
					mapTypeId: google.maps.MapTypeId.ROADMAP,
					zoomControlOptions: {
						style: google.maps.ZoomControlStyle.SMALL
					},
				});
					
				layerDep = new google.maps.FusionTablesLayer();
				drawLayerDepartamentos(layerDep, provincia);
				layerDep.setMap(map);
					
				layer = new google.maps.FusionTablesLayer();
				updateLayerQuery(layer, type, anio, provincia);
				layer.setMap(map);

				createLegend(map, type);
				styleLayerBySector(layer, type);
				styleMap(map);			
				$("#type-visualization-1").val("causa");
				drawVisualizationCausa(anio, provincia, "visualization-1")
				$("#type-visualization-2").val("edad");
				drawVisualizationEdad(anio, provincia, "visualization-2")
				setVariablesLeyenda(anio, provincia);
			});
		}
		
		function setProvincia2(){					
			var geocoder = new google.maps.Geocoder();
			geocoder.geocode({ 'address': "Argentina," + provincia2}, function(results,status){
				var latitude = results[0].geometry.location.lat();
				var longitude = results[0].geometry.location.lng();
					
				var map = new google.maps.Map(document.getElementById('map-canvas2'), {
					center: new google.maps.LatLng(latitude, longitude),
					zoom: 6,
					mapTypeId: google.maps.MapTypeId.ROADMAP,
					zoomControlOptions: {
						style: google.maps.ZoomControlStyle.SMALL
					},
				});
					
				layerDepComp = new google.maps.FusionTablesLayer();
				drawLayerDepartamentos(layerDepComp, provincia2);
				layerDepComp.setMap(map);
					
				layerComp = new google.maps.FusionTablesLayer();
				updateLayerQuery(layerComp, type, anio, provincia2);
				layerComp.setMap(map);

				createLegend(map, type);
				styleLayerBySector(layerComp, type);
				styleMap(map);			
				$("#type-visualization-3").val("causa");
				drawVisualizationCausa(anio, provincia2, "visualization-3")
				$("#type-visualization-4").val("edad");
				drawVisualizationEdad(anio, provincia2, "visualization-4")
			});
		}
		
		function drawChartVisualization(anio, provincia, visualization){
			var typeVisualization = $("#type-" + visualization).val();

			if (typeVisualization == "donde-ocurrio")
				drawVisualizationDondeOcurrio(anio, provincia, visualization)
				
			if (typeVisualization == "covertura-medica")
				drawVisualizationCoverturaMedica(anio, provincia, visualization)
				
			if (typeVisualization == "atencion-medica")
				drawVisualizationAtencionMedica(anio, provincia, visualization)
				
			if (typeVisualization == "nivel-instruccion")
				drawVisualizationNivelInstruccion(anio, provincia, visualization)
				
			if (typeVisualization == "edad")
				drawVisualizationEdad(anio, provincia, visualization)
			
			if (typeVisualization == "causa")			
				drawVisualizationCausa(anio, provincia, visualization)
		}
		  
		function drawLayerDepartamentos(layerDep, provincia){
			var where = "";
			if (provincia) {
				where += " provNombre contains ignoring case '" + provincia + "'";
			}
			layerDep.setOptions({
			  query: { 
				select: 'kml',
				from: '1OOIdn0U28iYbA280ccw_DRr3iiv27AKumWEbbus',
				where: where
			  }
			});
		}
		  
		function setStyleLayerDep(layerDep){
			var styles = new Array();
			styles.push({			
				polygonOptions: {
				  fillColor: '#f4cccc',
				  fillOpacity: 1
				}
			  });
			
			layerDep.set('styles', styles);
		}
		  
		function updateLayerQuery(layer, type, anio, provincia) {			
			var where = "";
			if (anio) {
				where += " anio = '" + anio + "'";
			}

			if (type == "residencia"){			
				where += "and residencia contains ignoring case '" + provincia + "'";
				
				layer.setOptions({
				  query: {
					select: 'kml',
					from: '1v4L4iF0UNl7_1i5t8KNeZOu43J5Z7wnu4Xoz7lI',
					where: where
				  }
				});
			}
			if (type == "ocurrencia"){
				where += "and ocurrencia contains ignoring case '" + provincia + "'";
				
				layer.setOptions({
				  query: {
					select: 'kml',
					from: '1alHU2f9TvZxXw7akRkZGXYDloVIwTEb_UBJn52c',
					where: where
				  }
				});
			}
			if(type == "depResidencia"){	
				var where = "";
				if (provincia) {
					where += " residencia contains ignoring case '" + provincia + "' and anio = '" + anio + "'";
				}
				layer.setOptions({
					query: {
					select: "kml",
					from: '1ktI6a8YHXAtOytgP538buvOYuA5CwCOFkC5UK6Q',
					where: where
					}
				});			
			}
		}
		  
		function ProvinciaDetalle(provincia, lat, lng){
			updateLayerQuery(layer, "tasa");
				
			layer.e.setZoom(6);
			layer.e.setCenter(new google.maps.LatLng(lat, lng));	
			drawVisualization(provincia);
			drawVisualizationCodMuer(provincia);
			
			return false;
		}
		  
		function createLegend(map, type) {
			var legendWrapper = document.createElement('div');
			legendWrapper.id = 'legendWrapper';
			legendWrapper.index = 1;
			map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(
				legendWrapper);
			legendContent(legendWrapper, type);
		}
		  
		function updateLegend(type) {
			var legendWrapper = $("#legendWrapper");
			legendWrapper.empty();
			legendContent(legendWrapper, type);
		}

		function legendContent(legendWrapper, type) {
			var sector = "escala";
			var legend = document.createElement('div');
			legend.id = 'legend';

			var title = document.createElement('p');
			title.innerHTML = sector;
			legend.appendChild(title);

			var layerStyle = LAYER_STYLES[sector];
			var colors = layerStyle.colors;
			var minNum = layerStyle.min;
			var maxNum = layerStyle.max;
			var step = (maxNum - minNum) / colors.length;
			for (var i = 0; i < colors.length; i++) {
				var legendItem = document.createElement('div');

				var color = document.createElement('div');
				color.setAttribute('class', 'color');
				color.style.backgroundColor = colors[i];
				legendItem.appendChild(color);

				var newMin = minNum + step * i;
				var newMax = newMin + step;
				var minMax = document.createElement('span');
				minMax.innerHTML = newMin + ' - ' + newMax;
				legendItem.appendChild(minMax);

				legend.appendChild(legendItem);
			}

			legendWrapper.appendChild(legend);
		}

		function updateLegend(sector) {
			var legendWrapper = document.getElementById('legendWrapper');
			var legend = document.getElementById('legend');
			legendWrapper.removeChild(legend);
			legendContent(legendWrapper, sector);
		}

		function styleLayerBySector(layer, type) {
			var layerStyle = LAYER_STYLES["escala"];
			var colors = layerStyle.colors;
			var minNum = layerStyle.min;
			var maxNum = layerStyle.max;
			var step = (maxNum - minNum) / colors.length;

			var styles = new Array();
			for (var i = 0; i < colors.length; i++) {
			  var newMin = minNum + step * i;
			  styles.push({
				where: generateWhere(newMin, "total"),
				polygonOptions: {
				  fillColor: colors[i],
				  fillOpacity: 1
				}
			  });
			}
			layer.set('styles', styles);
		}

		function generateWhere(minNum, column) {
			var whereClause = new Array();
			whereClause.push("'");
			whereClause.push(column);
			whereClause.push("' >= ");
			whereClause.push(minNum);
			return whereClause.join('');
		}

		function styleMap(map){
			var style = [{
			  featureType: 'all',
			  stylers: [{
				saturation: -99
			  }]
			}, {
			  featureType: 'poi',
			  stylers: [{
				visibility: 'off'
			  }]
			}, {
			  featureType: 'road',
			  stylers: [{
				visibility: 'off'
			  }]
			}];

			var styledMapType = new google.maps.StyledMapType(style, {
			  map: map,
			  name: 'Styled Map'
			});
			map.mapTypes.set('map-style', styledMapType);
			map.setMapTypeId('map-style');
		}
		  
		function drawVisualizationCoverturaMedica(anio, provincia, visualization){
			$.getJSON("https://www.googleapis.com/fusiontables/v1/query?sql=SELECT%20asociad,%20count()%20as%20count%20FROM%201ZU1BLsX-kccWHMR4o8N52rRE8EruBX7sXeuuYnM%20WHERE%20anio='"+anio+"'%20and%20residencia%20contains%20ignoring%20case%20'"+provincia+"'%20group%20by%20asociad&key=AIzaSyAkMTT3cQYD2XFfgtGQPmjd9OeMilKHYTo", function(data) {
				var datatable = new google.visualization.DataTable();
				var rows = ["0", "1", "2", "3", "4", "9" ];
				var rowsNames = ["0", "Obra Social", "Plan de salud privado o Mutual", "Ambas", "Ninguna", "Se ignora" ];				
				datatable.addColumn("string", "Covertura");
				datatable.addColumn("number", "Cantidad");
				datatable.addRows(6);
				$.each(rowsNames, function(key, rowName) {
					datatable.setCell(key, 0, rowName);	
				});				
				$.each(data.rows, function(key, row) {
					datatable.setCell(jQuery.inArray(row[0], rows), 1, parseInt(row[1]));			
				});
				
				var options = {
					width: "auto",
					height: 300,
					chartArea:{left:30,top:20,width:"50%",height:"80%"},
					title: "¿Tenían cobertura médica?"
				}
				
				var chart = new google.visualization.PieChart(document.getElementById(visualization));
				chart.draw(datatable, options);
			});
		}
		  
		function drawVisualizationAtencionMedica(anio, provincia, visualization) {
			$.getJSON("https://www.googleapis.com/fusiontables/v1/query?sql=SELECT%20atenmed,%20count()%20as%20count%20FROM%201ZU1BLsX-kccWHMR4o8N52rRE8EruBX7sXeuuYnM%20WHERE%20anio='"+anio+"'%20and%20residencia%20contains%20ignoring%20case%20'"+provincia+"'%20group%20by%20atenmed&key=AIzaSyAkMTT3cQYD2XFfgtGQPmjd9OeMilKHYTo", function(data) {
				var datatable = new google.visualization.DataTable();
				var rows = ["1", "2", "9" ];
				var rowsNames = ["Sí", "No", "Se ignora" ];				
				datatable.addColumn("string", "Atencion");
				datatable.addColumn("number", "Cantidad");
				datatable.addRows(3);
				$.each(rowsNames, function(key, rowName) {
					datatable.setCell(key, 0, rowName);	
				});				
				$.each(data.rows, function(key, row) {
					datatable.setCell(jQuery.inArray(row[0], rows), 1, parseInt(row[1]));			
				});
				
				var options = {
					width: "auto",
					height: 300,
					chartArea:{left:30,top:20,width:"50%",height:"80%"},
					title: "¿Tuvieron atención médica?"
				}
				
				var chart = new google.visualization.PieChart(document.getElementById(visualization));
				chart.draw(datatable, options);
			});
		}
		  
		function drawVisualizationDondeOcurrio(anio, provincia, visualization) {
			$.getJSON("https://www.googleapis.com/fusiontables/v1/query?sql=SELECT%20ocloc,%20count()%20as%20count%20FROM%201ZU1BLsX-kccWHMR4o8N52rRE8EruBX7sXeuuYnM%20WHERE%20anio='"+anio+"'%20and%20residencia%20contains%20ignoring%20case%20'"+provincia+"'%20group%20by%20ocloc&key=AIzaSyAkMTT3cQYD2XFfgtGQPmjd9OeMilKHYTo", function(data) {
				var datatable = new google.visualization.DataTable();
				var rows = ["1", "2", "3", "4", "9" ];
				var rowsNames = ["Estalecimiento de salud público", "Establecimiento de salud privado, obra social, etc.", "Vivienda (domicilio) particular", "Otro lugar ( vía pública, transportes, etc.)", "Se ignora" ];				
				datatable.addColumn("string", "Lugar");
				datatable.addColumn("number", "Cantidad");
				datatable.addRows(5);
				$.each(rowsNames, function(key, rowName) {
					datatable.setCell(key, 0, rowName);	
				});				
				$.each(data.rows, function(key, row) {
					datatable.setCell(jQuery.inArray(row[0], rows), 1, parseInt(row[1]));			
				});
				
				var options = {
					width: "auto",
					height: 300,
					chartArea:{left:30,top:20,width:"50%",height:"80%"},
					title: "¿Dónde murieron?"
				}
				
				var chart = new google.visualization.PieChart(document.getElementById(visualization));
				chart.draw(datatable, options);
			});
		}
		  
		function drawVisualizationNivelInstruccion(anio, provincia, visualization) {
			$.getJSON("https://www.googleapis.com/fusiontables/v1/query?sql=SELECT%20anio,%20finstruc,%20count()%20as%20count%20FROM%201ZU1BLsX-kccWHMR4o8N52rRE8EruBX7sXeuuYnM%20WHERE%20residencia%20contains%20ignoring%20case%20\'"+provincia+"\'%20group%20by%20finstruc,%20anio&key=AIzaSyAkMTT3cQYD2XFfgtGQPmjd9OeMilKHYTo", function(data) {
				var datatable = new google.visualization.DataTable();
				var columns = ["1", "3", "4", "5", "99" ];
				var columnsNames = ["Hasta primaria y EGB incompleto", "Primaria y EGB completo", "Secundaria y polimodal incompleto", "Secundaria y polimodal completo y más", "Sin especificar" ];
				var rows = [ "2006", "2007", "2008", "2009", "2010"];
				datatable.addColumn("string", "Anio");
				$.each(columnsNames, function(key, columnName) {
						datatable.addColumn("number", columnName);
				});	
				datatable.addRows(5);
				$.each(rows, function(key, row) {
					datatable.setCell(key, 0, row);										
				});
				$.each(data.rows, function(key, row) {
					datatable.setCell(jQuery.inArray(row[0], rows), (jQuery.inArray(row[1], columns)+1), parseInt(row[2]));										
				});
				
				var options = {
					isStacked:true,
					height: 300,
					width: "auto",
					chartArea:{left:30,top:20,width:"50%",height:"80%"},
					title: "¿Habían ido a la escuela?"
				};
				
				var chart = new google.visualization.ColumnChart(document.getElementById(visualization));
				chart.draw(datatable, options);
			});
		}
		  
		function drawVisualizationEdad(anio, provincia, visualization) {
			$.getJSON("https://www.googleapis.com/fusiontables/v1/query?sql=SELECT%20anio,%20grupedad,%20count()%20as%20count%20FROM%201ZU1BLsX-kccWHMR4o8N52rRE8EruBX7sXeuuYnM%20WHERE%20residencia%20contains%20ignoring%20case%20\'"+provincia+"\'%20group%20by%20grupedad,%20anio&key=AIzaSyAkMTT3cQYD2XFfgtGQPmjd9OeMilKHYTo", function(data) {
				var datatable = new google.visualization.DataTable();
				var columns = ["0", "10", "15", "20", "25", "30", "35", "40", "45" ];
				var columnsNames = ["Sin especificar", "10 a 14 años", "15 a 19 años", "20 a 24 años", "25 a 29 años", "30 a 34 años", "35 a 39 años", "40 a 44 años", "45 y más" ];
				var rows = [ "2006", "2007", "2008", "2009", "2010"];
				datatable.addColumn("string", "Anio");
				$.each(columnsNames, function(key, columnName) {
						datatable.addColumn("number", columnName);
				});	
				datatable.addRows(5);
				$.each(rows, function(key, row) {
					datatable.setCell(key, 0, row);										
				});
				$.each(data.rows, function(key, row) {
					datatable.setCell(jQuery.inArray(row[0], rows), (jQuery.inArray(row[1], columns)+1), parseInt(row[2]));				
				});
				
				var options = {				
					isStacked:true,
					height: 300,
					chartArea:{left:30,top:20,width:"50%",height:"80%"},
					width: "auto",
					title: "¿Qué edad tenían?"
				};
				
				var chart = new google.visualization.ColumnChart(document.getElementById(visualization));
				chart.draw(datatable, options);
			});	
		}

		function drawVisualizationCausa(anio, provincia, visualization) {
			$.getJSON("https://www.googleapis.com/fusiontables/v1/query?sql=SELECT%20'Aborto',%20'T_Hipert',%20'T_Placenta',%20'Otras_directas',%20'Hemorragia_post',%20'Sepsis_y_O',%20'Enf_por_VIH',%20'Otras_ind'%20FROM%201fW45Do4UhU9wknq2B57vOVza9VBi5HL4kiY58jM%20WHERE%20anio='"+anio+"'%20and%20provincia%20contains%20ignoring%20case%20'"+provincia+"'&key=AIzaSyAkMTT3cQYD2XFfgtGQPmjd9OeMilKHYTo", function(data) {
				var datatable = new google.visualization.DataTable();
				var rowsNames = ["Embarazo terminado en aborto", "Trastornos hipertensivos", "Trastornos de placenta y hemorragias", "Otras causas directas", "Hemorragia postparto", "Sepsis", "Enfermedad por V.I.H.", "Otras causas indirectas"];
				datatable.addColumn("string", "Causa");
				datatable.addColumn("number", "Proporcion");
				datatable.addRows(8);
				$.each(data.columns, function(key, column) {
					datatable.setCell(key, 0, rowsNames[key]);	
				});				
				$.each(data.rows[0], function(key, row) {
					datatable.setCell(key, 1, parseInt(row));			
				});
				
				var options = {
					width: "auto",
					height: 300,
					chartArea:{left:30,top:20,width:"50%",height:"80%"},
					title: "¿Por qué murieron?"
				}
				
				var chart = new google.visualization.PieChart(document.getElementById(visualization));
				chart.draw(datatable, options);
			});
		}
		
		function setVariablesLeyenda(anio, provincia) {
			$.getJSON("https://www.googleapis.com/fusiontables/v1/query?sql=SELECT%20'tasa',%20'Total'%20FROM%201fW45Do4UhU9wknq2B57vOVza9VBi5HL4kiY58jM%20WHERE%20anio='"+anio+"'%20and%20provincia%20contains%20ignoring%20case%20'"+provincia+"'&key=AIzaSyAkMTT3cQYD2XFfgtGQPmjd9OeMilKHYTo", function(data) {
				$("#anio-leyenda")[0].textContent = anio;
				$("#cantidad-leyenda")[0].textContent = data.rows[0][1];
				$("#tasa-leyenda")[0].textContent = data.rows[0][0];
			});
		}
		
		google.maps.event.addDomListener(window, 'load', initialize);
	</script>
	
{% endblock %}